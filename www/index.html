<!DOCTYPE html>
<html>

<head>
    <title>ESP32</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <meta charset='UTF-8'>
    <style>
        html {
            font-family: Arial, sans-serif;
            display: inline-block;
            margin: 0px auto;
            text-align: center;
        }

        p {
            font-size: 2.0rem;
        }
    </style>
    <script>
        // Initiate socket
        let socket;
        function init() {
            socket = new WebSocket('ws://' + window.location.hostname + ':80/');
            socket.onmessage = function (event) {
                processCommand(event);
            };
            // Send commands to change min-max temp and humid to ESP32 web server
            let data = new Object();
            document.getElementById('button-temp').onclick = function () {
                let minTemp = document.getElementById('input-min-temp').value;
                let maxTemp = document.getElementById('input-max-temp').value;
                if (minTemp != null && minTemp != "") {
                    data.min_temp = minTemp;
                };
                if (maxTemp != null && maxTemp != "") {
                    data.max_temp = maxTemp;
                };
                if (Object.keys(data).length) {
                    socket.send(JSON.stringify(data));
                    delete data.min_temp;
                    delete data.max_temp;
                };
            };
            document.getElementById('button-humid').onclick = function () {
                let minHumid = document.getElementById('input-min-humid').value;
                let maxHumid = document.getElementById('input-max-humid').value;
                if (minHumid != null && minHumid != "") {
                    data.min_humid = minHumid;
                };
                if (maxHumid != null && maxHumid != "") {
                    data.max_humid = maxHumid;
                };
                if (Object.keys(data).length) {
                    socket.send(JSON.stringify(data));
                    delete data.min_humid;
                    delete data.max_humid;
                };
            };
        }
        // Receive sensor data from ESP32 server and display on web page
        function processCommand(event) {
            var json_data = JSON.parse(event.data);
            console.log(json_data)
            document.getElementById('temp').innerHTML = json_data.temp;
            document.getElementById('humid').innerHTML = json_data.humid;
            document.getElementById('min-temp').innerHTML = json_data.min_temp;
            document.getElementById('max-temp').innerHTML = json_data.max_temp;
            document.getElementById('min-humid').innerHTML = json_data.min_humid;
            document.getElementById('max-humid').innerHTML = json_data.max_humid;
        }
        window.onload = function (event) {
            init();
        }
    </script>
</head>

<body>
    <h1>IoT N5 - Group 7</h1>
    <p>
        <span>Temperature: </span>
        <span id="temp">--.--</span>
        <span>&deg;C</span>
    </p>
    <p>
        <span>Humidity: </span>
        <span id="humid">--.--</span>
        <span>%</span>
    </p>
    <p>
        <span>Safe temperature range: </span>
        <span id="min-temp">--.--</span>
        <span>&deg;C</span>
        <span> to </span>
        <span id="max-temp">--.--</span>
        <span>&deg;C</span>
    </p>
    <input id="input-min-temp" type="number" placeholder="min temperature">
    <input id="input-max-temp" type="number" placeholder="max temperature">
    <button id="button-temp">Set</button>
    <p>
        <span>Safe humidity range: </span>
        <span id="min-humid">--.--</span>
        <span>%</span>
        <span> to </span>
        <span id="max-humid">--.--</span>
        <span>%</span>
    </p>
    <input id="input-min-humid" type="number" placeholder="min humidity">
    <input id="input-max-humid" type="number" placeholder="max humidity">
    <button id="button-humid">Set</button>
</body>

</html>
